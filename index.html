<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<title>Struk Belanja</title>

<style>
body{
    font-family: monospace;
    background:#f4f4f4;
}

.struk{
    width:230px; /* cocok untuk thermal 58mm */
    margin:auto;
    background:#fff;
    padding:10px;
    border:1px solid #ccc;
}

.center{text-align:center;}
hr{border-top:1px dashed #000;}

.logo{
    width:60px;
    margin-bottom:5px;
}

table{
    width:100%;
    font-size:11px;
    border-collapse: collapse;
}

td{
    vertical-align:top;
}

.total{
    font-weight:bold;
    font-size:13px;
}

.thanks{
    margin-top:10px;
    text-align:center;
    font-weight:bold;
}

.btn-print{
    margin-top:15px;
    width:100%;
    padding:8px;
    background:black;
    color:white;
    border:none;
    cursor:pointer;
}

/* Saat print tombol hilang */
@media print {
    .btn-print{
        display:none;
    }
    body{
        background:white;
    }
    .struk{
        border:none;
    }
}
</style>

<script>
function getParam(param){
    let urlParams = new URLSearchParams(window.location.search);
    return urlParams.get(param);
}

function formatRupiah(angka){
    if(!angka) return "0";

    // hapus semua karakter selain angka
    angka = angka.toString().replace(/[^0-9]/g,'');

    if(angka === "") return "0";

    return new Intl.NumberFormat('id-ID').format(parseInt(angka));
}

function cetakNota(){
    window.print();
}

    function formatDateTime(datetimeStr) {
    if (!datetimeStr) return "";

    // Coba parse menggunakan Date object (mendukung format YYYY-MM-DD HH:MM:SS atau YYYY-MM-DDTHH:MM:SS)
    let date = new Date(datetimeStr.replace(' ', 'T')); // Ganti spasi dengan 'T' untuk ISO
    if (!isNaN(date.getTime())) {
        let day = String(date.getDate()).padStart(2, '0');
        let month = String(date.getMonth() + 1).padStart(2, '0');
        let year = date.getFullYear();
        let hours = String(date.getHours()).padStart(2, '0');
        let minutes = String(date.getMinutes()).padStart(2, '0');
        let seconds = String(date.getSeconds()).padStart(2, '0');
        return `${day}/${month}/${year} ${hours}:${minutes}:${seconds}`;
    }

    // Jika gagal parse (misal format sudah DD/MM/YYYY), kembalikan string asli
    return datetimeStr;
    }
    
window.onload = function(){

    document.getElementById("nama_toko").innerHTML = getParam("nama_toko");
    document.getElementById("alamat_toko").innerHTML = getParam("alamat_toko");
    document.getElementById("telp_toko").innerHTML = "Telp: " + getParam("telp_toko");
    document.getElementById("id_transaksi").innerHTML = getParam("id_transaksi");
    document.getElementById("tanggal").innerHTML = formatDateTime(getParam("tanggal"));
    document.getElementById("nama_pelanggan").innerHTML = getParam("nama_pelanggan");
    
    document.getElementById("nama_kasir").innerHTML = getParam("nama_kasir");

    let nama_produk = (getParam("nama_produk") || "").split(",");
    let harga_produk = (getParam("harga_produk") || "").split(",");
    let qty = (getParam("qty") || "").split(",");
    let sub_total = (getParam("sub_total") || "").split(",");

    let tabel = document.getElementById("detail_produk");

    for(let i=0; i<nama_produk.length; i++){
        if(nama_produk[i] !== ""){
            let row = `
                <tr>
                    <td colspan="3">${nama_produk[i]}</td>
                </tr>
                <tr>
                    <td style="padding-left:15px;">${qty[i]} x ${formatRupiah(harga_produk[i])}</td>
                    <td></td>
                    <td align="right">${formatRupiah(sub_total[i])}</td>
                </tr>
            `;
            tabel.innerHTML += row;
        }
    }

    document.getElementById("total").innerHTML = "Rp" + formatRupiah(getParam("total"));
    document.getElementById("bayar").innerHTML = "Rp" + formatRupiah(getParam("bayar"));
    document.getElementById("kembali").innerHTML = "Rp" + formatRupiah(getParam("kembali"));
}
</script>
</head>

<body>

<div class="struk">

<div class="center">
    <img src="Logo.png" class="logo"><br>
    <b id="nama_toko"></b><br>
    <span id="alamat_toko"></span><br>
    <span id="telp_toko"></span>
</div>

<hr>

<!-- Info Transaksi Rapi dengan titik dua rata -->
<table style="width:100%; font-size:11px; margin-bottom:5px;">
<tr>
    <td style="width:35%;">ID</td>
    <td style="width:5%; text-align:center;">:</td>
    <td id="id_transaksi"></td>
</tr>
<tr>
    <td>Tanggal</td>
    <td style="text-align:center;">:</td>
    <td id="tanggal"></td>
</tr>
<tr>
    <td>Pelanggan</td>
    <td style="text-align:center;">:</td>
    <td id="nama_pelanggan"></td>
</tr>
<tr>
    <td>Kasir</td>
    <td style="text-align:center;">:</td>
    <td id="nama_kasir"></td>
</tr>
</table>

<hr>

<!-- Detail Produk -->
<table id="detail_produk"></table>

<hr>

<table>
<tr>
    <td>Total</td>
    <td></td>
    <td align="right" class="total" id="total"></td>
</tr>
<tr>
    <td>Bayar</td>
    <td></td>
    <td align="right" id="bayar"></td>
</tr>
<tr>
    <td>Kembali</td>
    <td></td>
    <td align="right" id="kembali"></td>
</tr>
</table>

<div class="thanks">
    Terima kasih telah berbelanja üôè
</div>

<button class="btn-print" onclick="cetakNota()">üñ® Cetak Nota</button>

</div>

</body>
</html> 
